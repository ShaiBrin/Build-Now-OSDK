{"version":3,"file":"createClient.js","names":["__EXPERIMENTAL__NOT_SUPPORTED_YET__getBulkLinks","__EXPERIMENTAL__NOT_SUPPORTED_YET__preexistingObjectSet","__EXPERIMENTAL__NOT_SUPPORTED_YET_subscribe","symbolClientContext","oldSymbolClientContext","createBulkLinksAsyncIterFactory","applyAction","additionalContext","createMinimalClient","fetchMetadataInternal","createObjectSet","getWireObjectSet","ObjectSetListenerWebsocket","applyQuery","ActionInvoker","constructor","clientCtx","actionDef","bind","undefined","batchApplyAction","QueryInvoker","queryDef","executeFunction","createClientInternal","objectSetFactory","baseUrl","ontologyRid","tokenProvider","options","fetchFn","fetch","fetchMetadata","client","Object","defineProperties","o","type","name","getBulkLinks","preexistingObjectSet","definition","rid","objectSets","objectType","apiName","reference","subscribe","objectSet","listener","pendingSubscribe","getInstance","Error","value","createClient"],"sources":["createClient.js"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { __EXPERIMENTAL__NOT_SUPPORTED_YET__getBulkLinks, __EXPERIMENTAL__NOT_SUPPORTED_YET__preexistingObjectSet, __EXPERIMENTAL__NOT_SUPPORTED_YET_subscribe, } from \"@osdk/api/unstable\";\nimport { symbolClientContext as oldSymbolClientContext } from \"@osdk/shared.client\";\nimport { symbolClientContext } from \"@osdk/shared.client2\";\nimport { createBulkLinksAsyncIterFactory } from \"./__unstable/createBulkLinksAsyncIterFactory.js\";\nimport { applyAction } from \"./actions/applyAction.js\";\nimport { additionalContext } from \"./Client.js\";\nimport { createMinimalClient } from \"./createMinimalClient.js\";\nimport { fetchMetadataInternal } from \"./fetchMetadata.js\";\nimport { createObjectSet, getWireObjectSet, } from \"./objectSet/createObjectSet.js\";\nimport { ObjectSetListenerWebsocket } from \"./objectSet/ObjectSetListenerWebsocket.js\";\nimport { applyQuery } from \"./queries/applyQuery.js\";\nclass ActionInvoker {\n    constructor(clientCtx, actionDef) {\n        // We type the property as a generic function as binding `applyAction`\n        // doesn't return a type thats all that useful anyway\n        // The implements covers us for the most part here as this exact type doesn't\n        // escape this file\n        this.applyAction = applyAction.bind(undefined, clientCtx, actionDef);\n        this.batchApplyAction = applyAction.bind(undefined, clientCtx, actionDef);\n    }\n    applyAction;\n    batchApplyAction;\n}\nclass QueryInvoker {\n    constructor(clientCtx, queryDef) {\n        this.executeFunction = applyQuery.bind(undefined, clientCtx, queryDef);\n    }\n    executeFunction;\n}\n/** @internal */\nexport function createClientInternal(objectSetFactory, // first so i can bind\nbaseUrl, ontologyRid, tokenProvider, options = undefined, fetchFn = fetch) {\n    const clientCtx = createMinimalClient({ ontologyRid }, baseUrl, tokenProvider, options, fetchFn, objectSetFactory);\n    function clientFn(o) {\n        if (o.type === \"object\" || o.type === \"interface\") {\n            return objectSetFactory(o, clientCtx);\n        }\n        else if (o.type === \"action\") {\n            return new ActionInvoker(clientCtx, o); // then as any for dealing with the conditional return value\n        }\n        else if (o.type === \"query\") {\n            return new QueryInvoker(clientCtx, o);\n        }\n        else if (o.type === \"experiment\") {\n            switch (o.name) {\n                case __EXPERIMENTAL__NOT_SUPPORTED_YET__getBulkLinks.name:\n                    return {\n                        getBulkLinks: createBulkLinksAsyncIterFactory(clientCtx),\n                    };\n                case __EXPERIMENTAL__NOT_SUPPORTED_YET__preexistingObjectSet.name:\n                    return {\n                        preexistingObjectSet: (definition, rid) => {\n                            return createObjectSet(definition, client[additionalContext], {\n                                type: \"intersect\",\n                                objectSets: [\n                                    {\n                                        type: \"base\",\n                                        objectType: definition.apiName,\n                                    },\n                                    {\n                                        type: \"reference\",\n                                        reference: rid,\n                                    },\n                                ],\n                            });\n                        },\n                    };\n                case __EXPERIMENTAL__NOT_SUPPORTED_YET_subscribe.name:\n                    return {\n                        subscribe: (objectSet, listener) => {\n                            const pendingSubscribe = ObjectSetListenerWebsocket.getInstance(clientCtx).subscribe(getWireObjectSet(objectSet), listener);\n                            return async () => (await pendingSubscribe)();\n                        },\n                    };\n            }\n            throw new Error(\"not implemented\");\n        }\n        else {\n            throw new Error(\"not implemented\");\n        }\n    }\n    const fetchMetadata = fetchMetadataInternal.bind(undefined, clientCtx);\n    const client = Object.defineProperties(clientFn, {\n        [oldSymbolClientContext]: {\n            value: clientCtx,\n        },\n        [symbolClientContext]: {\n            value: clientCtx,\n        },\n        [additionalContext]: {\n            value: clientCtx,\n        },\n        fetchMetadata: {\n            value: fetchMetadata,\n        },\n    });\n    return client;\n}\nexport const createClient = createClientInternal.bind(undefined, createObjectSet);\n"],"mappings":"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","ignoreList":[]}