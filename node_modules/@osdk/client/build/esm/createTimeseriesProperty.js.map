{"version":3,"file":"createTimeseriesProperty.js","names":["TimeseriesDurationMapping","OntologiesV2","iterateReadableStream","parseStreamedResponse","TimeSeriesPropertyImpl","triplet","client","constructor","objectApiName","primaryKey","propertyName","getFirstPoint","TimeSeriesPropertiesV2","ontologyRid","getLastPoint","getAllPoints","query","allPoints","point","asyncIterPoints","push","time","value","streamPointsIterator","streamPoints","range","getTimeRange","reader","stream","getReader","body","type","startTime","$startTime","endTime","$endTime","$before","when","unit","$unit","$after"],"sources":["createTimeseriesProperty.js"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { TimeseriesDurationMapping } from \"@osdk/api\";\nimport * as OntologiesV2 from \"@osdk/internal.foundry.ontologiesv2\";\nimport { iterateReadableStream, parseStreamedResponse, } from \"./util/streamutils.js\";\nexport class TimeSeriesPropertyImpl {\n    #triplet;\n    #client;\n    constructor(client, objectApiName, primaryKey, propertyName) {\n        this.#client = client;\n        this.#triplet = [objectApiName, primaryKey, propertyName];\n    }\n    async getFirstPoint() {\n        return OntologiesV2.TimeSeriesPropertiesV2.getFirstPoint(this.#client, await this.#client.ontologyRid, ...this.#triplet);\n    }\n    async getLastPoint() {\n        return OntologiesV2.TimeSeriesPropertiesV2.getLastPoint(this.#client, await this.#client.ontologyRid, ...this.#triplet);\n    }\n    async getAllPoints(query) {\n        const allPoints = [];\n        for await (const point of this.asyncIterPoints(query)) {\n            allPoints.push({\n                time: point.time,\n                value: point.value,\n            });\n        }\n        return allPoints;\n    }\n    async *asyncIterPoints(query) {\n        const streamPointsIterator = await OntologiesV2.TimeSeriesPropertiesV2\n            .streamPoints(this.#client, await this.#client.ontologyRid, ...this.#triplet, query ? { range: getTimeRange(query) } : {});\n        const reader = streamPointsIterator.stream().getReader();\n        for await (const point of parseStreamedResponse(iterateReadableStream(reader))) {\n            yield {\n                time: point.time,\n                value: point.value,\n            };\n        }\n    }\n}\nfunction getTimeRange(body) {\n    if (\"$startTime\" in body || \"$endTime\" in body) {\n        return {\n            type: \"absolute\",\n            startTime: body.$startTime,\n            endTime: body.$endTime,\n        };\n    }\n    return body.$before\n        ? {\n            type: \"relative\",\n            startTime: {\n                when: \"BEFORE\",\n                value: body.$before,\n                unit: TimeseriesDurationMapping[body.$unit],\n            },\n        }\n        : {\n            type: \"relative\",\n            endTime: {\n                when: \"AFTER\",\n                value: body.$after,\n                unit: TimeseriesDurationMapping[body.$unit],\n            },\n        };\n}\n"],"mappings":"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","ignoreList":[]}