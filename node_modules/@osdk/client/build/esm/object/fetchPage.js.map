{"version":3,"file":"fetchPage.js","names":["OntologiesV2","addUserAgentAndRequestContextHeaders","convertWireToOsdkObjects","augment","type","properties","apiName","objectSetToSearchJsonV2","objectSet","expectedApiName","existingWhere","undefined","objectType","Error","where","value","fetchInterfacePage","client","interfaceType","args","result","OntologyInterfaces","search","ontologyRid","applyFetchArgs","augmentedProperties","$augment","augmentedSharedPropertyTypes","otherInterfaceTypes","selectedObjectTypes","$__EXPERIMENTAL_selectedObjectTypes","selectedSharedPropertyTypes","$select","preview","data","$includeRid","fetchPageInternal","fetchObjectPage","fetchPageWithErrorsInternal","e","error","fetchPage","fetchPageWithErrors","body","$nextPageToken","pageToken","$pageSize","pageSize","$orderBy","orderBy","fields","Object","entries","map","field","direction","r","OntologyObjectSets","load","select","excludeRid","Promise","resolve","nextPageToken","totalCount"],"sources":["fetchPage.js"],"sourcesContent":["/*\n * Copyright 2023 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport * as OntologiesV2 from \"@osdk/internal.foundry.ontologiesv2\";\nimport { addUserAgentAndRequestContextHeaders } from \"../util/addUserAgentAndRequestContextHeaders.js\";\nimport { convertWireToOsdkObjects } from \"./convertWireToOsdkObjects.js\";\nexport function augment(type, ...properties) {\n    return { [type.apiName]: properties };\n}\n/** @internal */\nexport function objectSetToSearchJsonV2(objectSet, expectedApiName, existingWhere = undefined) {\n    if (objectSet.type === \"base\") {\n        if (objectSet.objectType !== expectedApiName) {\n            throw new Error(`Expected objectSet.objectType to be ${expectedApiName}, but got ${objectSet.objectType}`);\n        }\n        return existingWhere;\n    }\n    if (objectSet.type === \"filter\") {\n        return objectSetToSearchJsonV2(objectSet.objectSet, expectedApiName, existingWhere == null ? objectSet.where : {\n            type: \"and\",\n            value: [existingWhere, objectSet.where],\n        });\n    }\n    throw new Error(`Unsupported objectSet type: ${objectSet.type}`);\n}\nasync function fetchInterfacePage(client, interfaceType, args, objectSet) {\n    const result = await OntologiesV2.OntologyInterfaces\n        .search(addUserAgentAndRequestContextHeaders(client, interfaceType), await client.ontologyRid, interfaceType.apiName, applyFetchArgs(args, {\n        augmentedProperties: args.$augment ?? {},\n        augmentedSharedPropertyTypes: {},\n        otherInterfaceTypes: [],\n        selectedObjectTypes: args.$__EXPERIMENTAL_selectedObjectTypes ?? [],\n        selectedSharedPropertyTypes: args.$select ?? [],\n        where: objectSetToSearchJsonV2(objectSet, interfaceType.apiName),\n    }), { preview: true });\n    result.data = await convertWireToOsdkObjects(client, result.data, // drop readonly\n    interfaceType.apiName, !args.$includeRid);\n    return result;\n}\n/** @internal */\nexport async function fetchPageInternal(client, objectType, objectSet, args = {}) {\n    if (objectType.type === \"interface\") {\n        return await fetchInterfacePage(client, objectType, args, objectSet); // fixme\n    }\n    else {\n        return await fetchObjectPage(client, objectType, args, objectSet); // fixme\n    }\n}\n/** @internal */\nexport async function fetchPageWithErrorsInternal(client, objectType, objectSet, args = {}) {\n    try {\n        const result = await fetchPageInternal(client, objectType, objectSet, args);\n        return { value: result };\n    }\n    catch (e) {\n        if (e instanceof Error) {\n            return { error: e };\n        }\n        return { error: e };\n    }\n}\n/**\n * @param client\n * @param objectType\n * @param args\n * @param objectSet\n * @returns\n * @internal\n */\nexport async function fetchPage(client, objectType, args, objectSet = {\n    type: \"base\",\n    objectType: objectType[\"apiName\"],\n}) {\n    return fetchPageInternal(client, objectType, objectSet, args);\n}\n/** @internal */\nexport async function fetchPageWithErrors(client, objectType, args, objectSet = {\n    type: \"base\",\n    objectType: objectType[\"apiName\"],\n}) {\n    return fetchPageWithErrorsInternal(client, objectType, objectSet, args);\n}\nfunction applyFetchArgs(args, body) {\n    if (args?.$nextPageToken) {\n        body.pageToken = args.$nextPageToken;\n    }\n    if (args?.$pageSize != null) {\n        body.pageSize = args.$pageSize;\n    }\n    if (args?.$orderBy != null) {\n        body.orderBy = {\n            fields: Object.entries(args.$orderBy).map(([field, direction]) => ({\n                field,\n                direction,\n            })),\n        };\n    }\n    return body;\n}\n/** @internal */\nexport async function fetchObjectPage(client, objectType, args, objectSet) {\n    const r = await OntologiesV2.OntologyObjectSets.load(addUserAgentAndRequestContextHeaders(client, objectType), await client.ontologyRid, applyFetchArgs(args, {\n        objectSet,\n        // We have to do the following case because LoadObjectSetRequestV2 isn't readonly\n        select: (args?.$select ?? []), // FIXME?\n        excludeRid: !args?.$includeRid,\n    }));\n    return Promise.resolve({\n        data: await convertWireToOsdkObjects(client, r.data, undefined, undefined, args.$select),\n        nextPageToken: r.nextPageToken,\n        totalCount: r.totalCount,\n    });\n}\n"],"mappings":"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","ignoreList":[]}