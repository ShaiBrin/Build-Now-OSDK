{"version":3,"file":"getDollarLink.js","names":["getWireObjectSet","fetchSingle","fetchSingleWithErrors","ClientRef","ObjectDefRef","RawObject","get$link","holder","Proxy","DollarLinkProxyHandler","get","target","p","objDef","client","rawObj","linkDef","links","objectSet","objectSetFactory","where","primaryKeyApiName","$primaryKey","pivotTo","multiplicity","fetchOne","options","fetchOneWithErrors","ownKeys","Object","keys","getOwnPropertyDescriptor","enumerable","configurable","writable"],"sources":["getDollarLink.js"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { getWireObjectSet } from \"../../objectSet/createObjectSet.js\";\nimport { fetchSingle, fetchSingleWithErrors } from \"../fetchSingle.js\";\nimport { ClientRef, ObjectDefRef, RawObject } from \"./InternalSymbols.js\";\n/** @internal */\nexport function get$link(holder) {\n    return new Proxy(holder, DollarLinkProxyHandler);\n}\nconst DollarLinkProxyHandler = {\n    get(target, p) {\n        const { [ObjectDefRef]: objDef, [ClientRef]: client, [RawObject]: rawObj, } = target;\n        const linkDef = objDef.links[p];\n        if (linkDef == null) {\n            return;\n        }\n        const objectSet = client.objectSetFactory(objDef, client)\n            .where({\n            [objDef.primaryKeyApiName]: rawObj.$primaryKey,\n        })\n            .pivotTo(p);\n        if (!linkDef.multiplicity) {\n            return {\n                fetchOne: (options) => fetchSingle(client, objDef, options ?? {}, getWireObjectSet(objectSet)),\n                fetchOneWithErrors: (options) => fetchSingleWithErrors(client, objDef, options ?? {}, getWireObjectSet(objectSet)),\n            };\n        }\n        else {\n            return objectSet;\n        }\n    },\n    ownKeys(target) {\n        return [...Object.keys(target[ObjectDefRef].links)];\n    },\n    getOwnPropertyDescriptor(target, p) {\n        if (target[ObjectDefRef].links[p]) {\n            return {\n                enumerable: true,\n                configurable: true, // fixme\n                writable: false,\n            };\n        }\n    },\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,gBAAgB,QAAQ,oCAAoC;AACrE,SAASC,WAAW,EAAEC,qBAAqB,QAAQ,mBAAmB;AACtE,SAASC,SAAS,EAAEC,YAAY,EAAEC,SAAS,QAAQ,sBAAsB;AACzE;AACA,OAAO,SAASC,QAAQA,CAACC,MAAM,EAAE;EAC7B,OAAO,IAAIC,KAAK,CAACD,MAAM,EAAEE,sBAAsB,CAAC;AACpD;AACA,MAAMA,sBAAsB,GAAG;EAC3BC,GAAGA,CAACC,MAAM,EAAEC,CAAC,EAAE;IACX,MAAM;MAAE,CAACR,YAAY,GAAGS,MAAM;MAAE,CAACV,SAAS,GAAGW,MAAM;MAAE,CAACT,SAAS,GAAGU;IAAQ,CAAC,GAAGJ,MAAM;IACpF,MAAMK,OAAO,GAAGH,MAAM,CAACI,KAAK,CAACL,CAAC,CAAC;IAC/B,IAAII,OAAO,IAAI,IAAI,EAAE;MACjB;IACJ;IACA,MAAME,SAAS,GAAGJ,MAAM,CAACK,gBAAgB,CAACN,MAAM,EAAEC,MAAM,CAAC,CACpDM,KAAK,CAAC;MACP,CAACP,MAAM,CAACQ,iBAAiB,GAAGN,MAAM,CAACO;IACvC,CAAC,CAAC,CACGC,OAAO,CAACX,CAAC,CAAC;IACf,IAAI,CAACI,OAAO,CAACQ,YAAY,EAAE;MACvB,OAAO;QACHC,QAAQ,EAAGC,OAAO,IAAKzB,WAAW,CAACa,MAAM,EAAED,MAAM,EAAEa,OAAO,IAAI,CAAC,CAAC,EAAE1B,gBAAgB,CAACkB,SAAS,CAAC,CAAC;QAC9FS,kBAAkB,EAAGD,OAAO,IAAKxB,qBAAqB,CAACY,MAAM,EAAED,MAAM,EAAEa,OAAO,IAAI,CAAC,CAAC,EAAE1B,gBAAgB,CAACkB,SAAS,CAAC;MACrH,CAAC;IACL,CAAC,MACI;MACD,OAAOA,SAAS;IACpB;EACJ,CAAC;EACDU,OAAOA,CAACjB,MAAM,EAAE;IACZ,OAAO,CAAC,GAAGkB,MAAM,CAACC,IAAI,CAACnB,MAAM,CAACP,YAAY,CAAC,CAACa,KAAK,CAAC,CAAC;EACvD,CAAC;EACDc,wBAAwBA,CAACpB,MAAM,EAAEC,CAAC,EAAE;IAChC,IAAID,MAAM,CAACP,YAAY,CAAC,CAACa,KAAK,CAACL,CAAC,CAAC,EAAE;MAC/B,OAAO;QACHoB,UAAU,EAAE,IAAI;QAChBC,YAAY,EAAE,IAAI;QAAE;QACpBC,QAAQ,EAAE;MACd,CAAC;IACL;EACJ;AACJ,CAAC","ignoreList":[]}