{"version":3,"file":"createOsdkInterface.js","names":["extractNamespace","createSimpleCache","InterfaceDefRef","ObjectDefRef","UnderlyingOsdkObject","handlerCache","WeakMap","createInterfaceProxyHandler","createOsdkInterface","underlying","interfaceDef","handler","get","proxy","Proxy","newDef","getOwnPropertyDescriptor","target","p","objDef","Reflect","undefined","enumerable","configurable","value","apiName","objApiNamespace","apiNamespace","properties","interfaceMap","ownKeys","propNames","Object","keys","map"],"sources":["createOsdkInterface.js"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { extractNamespace } from \"../../internal/conversions/modernToLegacyWhereClause.js\";\nimport { createSimpleCache } from \"../SimpleCache.js\";\nimport { InterfaceDefRef, ObjectDefRef, UnderlyingOsdkObject, } from \"./InternalSymbols.js\";\nconst handlerCache = createSimpleCache(new WeakMap(), createInterfaceProxyHandler);\n/** @internal */\nexport function createOsdkInterface(underlying, interfaceDef) {\n    const interfaceHolder = {\n        [UnderlyingOsdkObject]: underlying,\n        [InterfaceDefRef]: interfaceDef,\n    };\n    const handler = handlerCache.get(interfaceDef);\n    const proxy = new Proxy(interfaceHolder, // the wrapper doesn't contain everything obviously. we proxy\n    handler);\n    return proxy;\n}\nfunction createInterfaceProxyHandler(newDef) {\n    return {\n        getOwnPropertyDescriptor(target, p) {\n            const underlying = target[UnderlyingOsdkObject];\n            const objDef = underlying[ObjectDefRef];\n            switch (p) {\n                case \"$primaryKey\":\n                case \"$title\":\n                case \"$objectType\":\n                case \"$rid\":\n                    return underlying[p] != null\n                        ? Reflect.getOwnPropertyDescriptor(underlying, p)\n                        : undefined;\n                case \"$apiName\":\n                    return {\n                        enumerable: true,\n                        configurable: true,\n                        value: target[InterfaceDefRef].apiName,\n                    };\n            }\n            const [objApiNamespace] = extractNamespace(newDef.apiName);\n            if (objApiNamespace != null) {\n                const [apiNamespace, apiName] = extractNamespace(p);\n                if (apiNamespace == null) {\n                    p = `${objApiNamespace}.${apiName}`;\n                }\n            }\n            if (newDef.properties[p] != null) {\n                return {\n                    enumerable: true,\n                    configurable: true,\n                    value: underlying[objDef.interfaceMap[newDef.apiName][p]],\n                };\n            }\n        },\n        ownKeys(target) {\n            const underlying = target[UnderlyingOsdkObject];\n            const [objApiNamespace] = extractNamespace(newDef.apiName);\n            let propNames = Object.keys(newDef.properties);\n            if (objApiNamespace != null) {\n                propNames = propNames.map(p => {\n                    const [apiNamespace, apiName] = extractNamespace(p);\n                    if (apiNamespace === objApiNamespace) {\n                        p = apiName;\n                    }\n                    return p;\n                });\n            }\n            return [\n                \"$apiName\",\n                \"$objectType\",\n                \"$primaryKey\",\n                ...(underlying[\"$rid\"] ? [\"$rid\"] : []),\n                \"$title\",\n                ...propNames,\n            ];\n        },\n        get(target, p) {\n            const underlying = target[UnderlyingOsdkObject];\n            switch (p) {\n                case InterfaceDefRef:\n                    return newDef;\n                case \"$apiName\":\n                    return newDef.apiName;\n                case \"$as\":\n                case UnderlyingOsdkObject:\n                case \"$primaryKey\":\n                case \"$title\":\n                case \"$objectType\":\n                case \"$rid\":\n                    return underlying[p];\n            }\n            const [objApiNamespace] = extractNamespace(newDef.apiName);\n            if (objApiNamespace != null) {\n                const [apiNamespace, apiName] = extractNamespace(p);\n                if (apiNamespace == null) {\n                    p = `${objApiNamespace}.${apiName}`;\n                }\n            }\n            if (newDef.properties[p] != null) {\n                const objDef = target[UnderlyingOsdkObject][ObjectDefRef];\n                return underlying[objDef.interfaceMap[newDef.apiName][p]];\n            }\n        },\n    };\n}\n"],"mappings":"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","ignoreList":[]}