{"version":3,"file":"createOsdkObject.js","names":["createAttachmentFromRid","TimeSeriesPropertyImpl","createClientCache","get$as","get$link","ClientRef","ObjectDefRef","RawObject","UnderlyingOsdkObject","objectPrototypeCache","client","objectDef","Object","create","value","get","newValues","assign","createOsdkObject","rawObj","objectHolderPrototype","writable","holder","osdkObject","Proxy","ownKeys","target","Reflect","p","receiver","rawValue","propDef","properties","type","Array","isArray","map","a","rid","apiName","primaryKeyApiName","set","newValue","getOwnPropertyDescriptor","configurable","enumerable","undefined"],"sources":["createOsdkObject.js"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createAttachmentFromRid } from \"../../createAttachmentFromRid.js\";\nimport { TimeSeriesPropertyImpl } from \"../../createTimeseriesProperty.js\";\nimport { createClientCache } from \"../Cache.js\";\nimport { get$as } from \"./getDollarAs.js\";\nimport { get$link } from \"./getDollarLink.js\";\nimport { ClientRef, ObjectDefRef, RawObject, UnderlyingOsdkObject, } from \"./InternalSymbols.js\";\nconst objectPrototypeCache = createClientCache(function (client, objectDef) {\n    return Object.create(null, {\n        [ObjectDefRef]: { value: objectDef },\n        [ClientRef]: { value: client },\n        \"$as\": { value: get$as(objectDef) },\n        \"$link\": {\n            get: function () {\n                return get$link(this);\n            },\n        },\n        \"$updateInternalValues\": {\n            value: function (newValues) {\n                this[RawObject] = Object.assign({}, this[RawObject], newValues);\n            },\n        },\n    });\n});\n/** @internal */\nexport function createOsdkObject(client, objectDef, rawObj) {\n    // We use multiple layers of prototypes to maximize reuse and also to keep\n    // [RawObject] out of `ownKeys`. This keeps the code in the proxy below simpler.\n    const objectHolderPrototype = Object.create(objectPrototypeCache.get(client, objectDef), {\n        [RawObject]: {\n            value: rawObj,\n            writable: true, // so we can allow updates\n        },\n    });\n    // we separate the holder out so we can update\n    // the underlying data without having to return a new object\n    // we also need the holder so we can customize the console.log output\n    const holder = Object.create(objectHolderPrototype);\n    const osdkObject = new Proxy(holder, {\n        ownKeys(target) {\n            return Reflect.ownKeys(target[RawObject]);\n        },\n        get(target, p, receiver) {\n            switch (p) {\n                case UnderlyingOsdkObject:\n                    // effectively point back to the proxy\n                    return receiver;\n            }\n            if (p in target)\n                return target[p];\n            if (p in rawObj) {\n                const rawValue = target[RawObject][p];\n                const propDef = objectDef.properties[p];\n                if (propDef) {\n                    if (propDef.type === \"attachment\") {\n                        if (Array.isArray(rawValue)) {\n                            return rawValue.map(a => createAttachmentFromRid(client, a.rid));\n                        }\n                        return createAttachmentFromRid(client, rawValue.rid);\n                    }\n                    if (propDef.type === \"numericTimeseries\"\n                        || propDef.type === \"stringTimeseries\") {\n                        return new TimeSeriesPropertyImpl(client, objectDef.apiName, target[RawObject][objectDef.primaryKeyApiName], p);\n                    }\n                }\n                return rawValue;\n            }\n            // we do not do any fall through to avoid unexpected behavior\n        },\n        set(target, p, newValue) {\n            // allow the prototype to update this value\n            if (p === RawObject) {\n                // symbol only exists internally so no one else can hit this\n                target[p] = newValue;\n                return true;\n            }\n            return false;\n        },\n        getOwnPropertyDescriptor(target, p) {\n            if (p === RawObject) {\n                return Reflect.getOwnPropertyDescriptor(target, p);\n            }\n            if (target[RawObject][p] != null) {\n                return { configurable: true, enumerable: true };\n            }\n            return undefined;\n        },\n    });\n    return osdkObject;\n}\n"],"mappings":"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","ignoreList":[]}