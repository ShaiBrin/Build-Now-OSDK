{"version":3,"file":"StandardOntologyProvider.js","names":["createAsyncClientCache","loadActionMetadata","loadFullObjectMetadata","loadInterfaceMetadata","loadQueryMetadata","InterfaceDefinitions","createStandardOntologyProviderFactory","client","makeGetter","fn","cache","key","apiName","get","ret","getObjectDefinition","objectDef","interfaceDefs","Object","fromEntries","Promise","all","implements","map","i","getInterfaceDefinition","def","handler","undefined","fullObjectDef","getQueryDefinition","r","getActionDefinition"],"sources":["StandardOntologyProvider.js"],"sourcesContent":["/*\n * Copyright 2024 Palantir Technologies, Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createAsyncClientCache } from \"../object/Cache.js\";\nimport { loadActionMetadata } from \"./loadActionMetadata.js\";\nimport { loadFullObjectMetadata } from \"./loadFullObjectMetadata.js\";\nimport { loadInterfaceMetadata } from \"./loadInterfaceMetadata.js\";\nimport { loadQueryMetadata } from \"./loadQueryMetadata.js\";\nimport { InterfaceDefinitions, } from \"./OntologyProvider.js\";\nexport const createStandardOntologyProviderFactory = (client) => {\n    return (client) => {\n        async function loadObject(client, key) {\n            let objectDef = await loadFullObjectMetadata(client, key);\n            // ensure we have all of the interfaces loaded\n            const interfaceDefs = Object.fromEntries((await Promise.all(objectDef.implements?.map((i) => ret.getInterfaceDefinition(i)) ?? [])).map(i => [i.apiName, { def: i, handler: undefined }]));\n            const fullObjectDef = {\n                ...objectDef,\n                [InterfaceDefinitions]: interfaceDefs,\n            };\n            return fullObjectDef;\n        }\n        async function loadInterface(client, key) {\n            return loadInterfaceMetadata(client, key);\n        }\n        async function loadQuery(client, key) {\n            const r = await loadQueryMetadata(client, key);\n            return r;\n        }\n        async function loadAction(client, key) {\n            const r = await loadActionMetadata(client, key);\n            return r;\n        }\n        function makeGetter(fn) {\n            const cache = createAsyncClientCache((client, key) => fn(client, key, false));\n            return async (apiName) => {\n                return await cache.get(client, apiName);\n            };\n        }\n        const ret = {\n            getObjectDefinition: makeGetter(loadObject),\n            getInterfaceDefinition: makeGetter(loadInterface),\n            getQueryDefinition: makeGetter(loadQuery),\n            getActionDefinition: makeGetter(loadAction),\n        };\n        return ret;\n    };\n};\n"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAASA,sBAAsB,QAAQ,oBAAoB;AAC3D,SAASC,kBAAkB,QAAQ,yBAAyB;AAC5D,SAASC,sBAAsB,QAAQ,6BAA6B;AACpE,SAASC,qBAAqB,QAAQ,4BAA4B;AAClE,SAASC,iBAAiB,QAAQ,wBAAwB;AAC1D,SAASC,oBAAoB,QAAS,uBAAuB;AAC7D,OAAO,MAAMC,qCAAqC,GAAGA,CAAA,KAAY;EAC7D,OAAQC,MAAM,IAAK;IAsBf,SAASC,UAAUA,CAACC,EAAE,EAAE;MACpB,MAAMC,KAAK,GAAGV,sBAAsB,CAAC,CAACO,MAAM,EAAEI,GAAG,KAAKF,EAAE,CAACF,MAAM,EAAEI,GAAG,EAAE,KAAK,CAAC,CAAC;MAC7E,OAAO,MAAOC,OAAO,IAAK;QACtB,OAAO,MAAMF,KAAK,CAACG,GAAG,CAACN,MAAM,EAAEK,OAAO,CAAC;MAC3C,CAAC;IACL;IACA,MAAME,GAAG,GAAG;MACRC,mBAAmB,EAAEP,UAAU,CA5BnC,gBAA0BD,MAAM,EAAEI,GAAG,EAAE;QACnC,IAAIK,SAAS,GAAG,MAAMd,sBAAsB,CAACK,MAAM,EAAEI,GAAG,CAAC;QACzD;QACA,MAAMM,aAAa,GAAGC,MAAM,CAACC,WAAW,CAAC,CAAC,MAAMC,OAAO,CAACC,GAAG,CAACL,SAAS,CAACM,UAAU,EAAEC,GAAG,CAAEC,CAAC,IAAKV,GAAG,CAACW,sBAAsB,CAACD,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,EAAED,GAAG,CAACC,CAAC,IAAI,CAACA,CAAC,CAACZ,OAAO,EAAE;UAAEc,GAAG,EAAEF,CAAC;UAAEG,OAAO,EAAEC;QAAU,CAAC,CAAC,CAAC,CAAC;QAC1L,MAAMC,aAAa,GAAG;UAClB,GAAGb,SAAS;UACZ,CAACX,oBAAoB,GAAGY;QAC5B,CAAC;QACD,OAAOY,aAAa;MACxB,CAmB8C,CAAC;MAC3CJ,sBAAsB,EAAEjB,UAAU,CAnBtC,gBAA6BD,MAAM,EAAEI,GAAG,EAAE;QACtC,OAAOR,qBAAqB,CAACI,MAAM,EAAEI,GAAG,CAAC;MAC7C,CAiBoD,CAAC;MACjDmB,kBAAkB,EAAEtB,UAAU,CAjBlC,gBAAyBD,MAAM,EAAEI,GAAG,EAAE;QAClC,MAAMoB,CAAC,GAAG,MAAM3B,iBAAiB,CAACG,MAAM,EAAEI,GAAG,CAAC;QAC9C,OAAOoB,CAAC;MACZ,CAc4C,CAAC;MACzCC,mBAAmB,EAAExB,UAAU,CAdnC,gBAA0BD,MAAM,EAAEI,GAAG,EAAE;QACnC,MAAMoB,CAAC,GAAG,MAAM9B,kBAAkB,CAACM,MAAM,EAAEI,GAAG,CAAC;QAC/C,OAAOoB,CAAC;MACZ,CAW8C;IAC9C,CAAC;IACD,OAAOjB,GAAG;EACd,CAAC;AACL,CAAC","ignoreList":[]}